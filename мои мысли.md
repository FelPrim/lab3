Клиент должен обладать возможностью создать конференцию, к ней присоединиться, отсоединиться, закончить конференцию.

Может ли клиент присоединиться к нескольким конференциям?

Сервер - Linux, клиент - Windows, Linux, (очень маловероятно) Android, браузер...

Реализация должна быть масшатбируемой - т.е. надо сделать так, чтобы легко можно было разделить программу на:

Основной сервер

сервера-хосты конференций

клиенты (могут связываться с клиентами из других серверов).

Как работают:

TCP:

1. Включается глобальный сервер. Открывает глобальный tcp порт.
2. Включается клиент. Подключается к серверу по глобальному tcp-порту.
Наверное, для того чтобы зайти в конференцию, нужно добавить другие аккаунты в друзья. Поэтому:
3. Клиент регистрируется/авторизуется по логину-паролю.

3.1. Регистрация: Клиент посылает запрос на сервер с информацией о том, что:

Это регистрация нового пользователя

Логин пользователя

Пароль пользователя

Этот запрос должен быть зашифрован. Значит, до того, как был послан запрос на сервер производится обмен ключами шифрования?

3.2. Авторизация: Клиент вписывает логин/пароль

4. Добавление в друзья:

4.1. Клиент отправляет запрос на сервер с информацией о том, кого он хочет "добавить в друзья":

Это добавление в друзья

Логин того, кого добавляют

Информация о том, кто добавляет (может быть, это можно понять через то, в какой сокет пришло сообщение?)

4.2. Сервер отправляет запрос обладателю логина о том, что его хотят добавить в друзья. 

Если чел с логином оффлайн, то сервер сохраняет информацию о том, что чела собираются добавить в друзья, и при подключении чела отправляет ему сообщение о том, что его хотят добавить в друзья.

Это добавление в друзья

Логин того, кто хочет добавиться

4.3. Обладатель получает запрос. Он может: проигнорировать / согласиться / отказаться. Если он не игнорирует, то он посылает на сервер запрос с формой:

Это добавление в друзья

Логин того, добавление в друзья кого чел одобрил

Согласен чел или нет (bool)

Информация о том, кого добавляют (мб через сокет понятно)

5. Создание конференции:

5.1. Клиент отправляет запрос серверу о том, что создаёт конференцию

Сервер генерирует id конференции и отсылает его клиенту. После этого он отсылает всем друзьям клиента информацию о том, что клиент находится в конференции

5.2 Клиент отправляет запрос серверу о том, что он хочет удалить конференцию

Конференция

id конференции

Информация о том, кто удаляет конференцию (вдруг это рандомный чел отправил запрос)

5.3. Клиент отправляет запрос серверу, что он хочет присоединиться к конференции:

А как он поймет, к какой конференции надо присоединяться? Значит, у конференции должно быть какое-то поле, через которое пользователь сможет различать конференции между собой.

Допустим, конференции можно называть. Надо добавить условие, что нельзя быть в 2 конференциях с одинаковыми названиями одновременно. 

Соответственно, если чел одновременно авторизовался с разных устройств, то он не может сидеть в одной и той же конференции. Мб добавить отдельно возможность присоединиться в таких случаях?

Если друг находится только в 1 конференции, то для того, чтобы присоединиться к ней, с точки зрения клиента достаточно кликнуть по другу и кликнуть "присоединиться"

Протокол подсоединения к конференции:

Конференция

id конференции

Информация о том, кто присоединяется

Сервер проверяет, есть ли участник в конференции с таким же именем. Если есть - отправляет соответствующую ошибку.

Если друг находится одновременно в нескольких конференциях, то для того, чтобы присоединиться к конференции нужно указать её имя. Протокол точно такой же. 

Проверка на имя может проходить и на клиенте.

После это клиент посылает всем участникам информацию о том, что в конференции есть новый участник. Участник обменивается ключами шифрования с каждым из предыдущих и они начинают обмен потоками.

Подробнее об этом в отдельной сноске.

5.4. Клиент посылает запрос серверу о том, что он хочет отсоединиться от конференции:

Конференция

id конференции

Информация о том, кто отсоединяется.

Если в конференции только 1 участник, то происходит её удаление


UDP:

думать буду после реализации ранее изложенного. Пока что пусть это будет просто передача сообщений.


GUI:

Окно авторизации:

Логин

Пароль



Основное меню:

Список запросов дружбы.

Список друзей. Если друг в 1 конференции - имя этой конференции + кнопка присоединиться. Если друг в 2+ конференциях - кнопка "находится в конференциях", при нажатии на которую открывается список конференций, 

в которых есть друг + кнопка присоединиться.

Кнопка создать конференцию.

Кнопка подсоединиться к КОНФЕРЕНЦИИ - конференции, которую невозможно удалить и к которой может подсоединиться каждый.

Окно "добавить друга" - ввод логина.



Конференция (отдельное окно):

Видео участников конференции

Информация о том, кто владелец

Кнопки: покинуть конференцию

Если владелец: переименовать, поменять владельца, завершить

Мб ПКМ по видео открывает возможность добавить в друзья

Мб добавить ПКМ по видео: возможность отключить видео/аудио.

Мб добавить ПКМ по видео: возможность в конференции отключить видео/аудио.


Результат:

TCP:

1. Включается глобальный сервер. Открывает глобальный tcp порт.
2. Включается клиент. Подключается к серверу по глобальному tcp-порту.

Обмен ключами шифрования

3. Клиент регистрируется/авторизуется по логину-паролю.

3.1. Регистрация: Клиент посылает зашифрованный запрос на сервер с информацией о том, что:

Это регистрация нового пользователя

Логин пользователя

Пароль пользователя

Сервер добавляет информацию в БД. 

3.2. Авторизация: Клиент вписывает логин/пароль

3,5. Подгрузка информации:



3,5.1 Сервер отсылает клиенту сообщения с информацией о всех, кто хочет добавить клиента в друзья.

3,5.2 Сервер отсылает клиенту информацию о том, кто является его другом.

3,5.3 Сервер отсылает клиенту информацию о том, кто из друзей находится в каких конференциях.


4. Добавление в друзья:

4.1. Клиент отправляет запрос на сервер с информацией о том, кого он хочет "добавить в друзья":

Это добавление в друзья1

Логин того, кого добавляют


Информация о запросе на дружбу:

Запрашивающий, запрашиваемый


Информация о том, кто добавляет (может быть, это можно понять через то, в какой сокет пришло сообщение?)

4.1,5. Мб если пользователя с таким логином нет, то сервер отправляет клиенту сообщение об этой ошибке.

4.1,75. Мб добавить возможность отменить запрос на дружбу?


4.2. Сервер отправляет запрос обладателю логина о том, что его хотят добавить в друзья. 

Если чел с логином оффлайн, то сервер сохраняет информацию о том, что чела собираются добавить в друзья, и при подключении чела отправляет ему сообщение о том, что его хотят добавить в друзья.

Это добавление в друзья2

Логин того, кто хочет добавиться

4.3. Обладатель получает запрос. Он может: проигнорировать / согласиться / отказаться. Если он не игнорирует, то он посылает на сервер запрос с формой:

Это добавление в друзья3

Логин того, добавление в друзья кого чел одобрил

Согласен чел или нет (bool)

Информация о том, кого добавляют (мб через сокет понятно)


Информация о дружбе:

Дружащий1, дружащий2. Допустим, порядок определяется через strcmp (аналог для Unicode)


После этого сервер гарантировано убирает из таблицы с информацией о запросах на дружбу данный запрос и, возможно, добавляет дружбу в табличку.

Сервер посылает тому, кто отправил запрос, информацию о том, что появился новый друг. У клиента, который согласился на дружбу, автоматически обновляется информация о том, что такой-то друг есть


4.3,5. Обновляется информация о списке друзей в конференциях


4.4. Чел, который дружит с кем-то, может отправить запрос на отзыв дружбы:

Это добавление в друзья4

Логин того, кого чел хочет удалить из друзей

Информация о том, кто удаляет (мб через сокет)

Сервер обновляет табличку друзей и отправляет запрос-обновление друзей клиента exfriend.


5. Создание конференции:

5.1. Клиент отправляет запрос серверу о том, что создаёт конференцию

Протокол:

Конференция1

Имя конференции

Информация о создателе (сокет?)

Сервер генерирует id конференции и отсылает его клиенту. 

Этот id записывается в табличку. У каждой конференции есть владелец (иначе как проверить то, что её можно удалить). Автоматически владельцем становится создатель.

После этого он отсылает всем друзьям клиента информацию о том, что клиент находится в конференции.


Информация о конференции:

id, имя, владелец, участники


5.2 Клиент отправляет запрос серверу о том, что он хочет удалить конференцию

Конференция2

id конференции

Информация о том, кто удаляет конференцию (вдруг это рандомный чел отправил запрос)


Сервер проверяет, может ли клиент подсоединиться к конференции, и если может, то он добавляет клиента в список участников конференции. Обновляет информацию о том, что клиент
находится в конференции у друзей клиента.


5.2,5 Запрос на изменение имени конференции

Конференция3

id конференции

Новое имя

Кто изменяет имя (владелец)


5.2,75: Запрос на изменение владельца конференции

Конференция4

id 

Новый владелец

Отправитель запроса (владелец)

Добавить проверку на то, что новый владелец - участник


5.3. Клиент отправляет запрос серверу, что он хочет присоединиться к конференции:

Если друг находится только в 1 конференции, то для того, чтобы присоединиться к ней, с точки зрения клиента достаточно кликнуть по другу и кликнуть "присоединиться"

Протокол подсоединения к конференции:

Конференция

id конференции

Информация о том, кто присоединяется

Сервер проверяет, есть ли участник в конференции с таким же именем. Если есть - отправляет соответствующую ошибку.

Если друг находится одновременно в нескольких конференциях, то для того, чтобы присоединиться к конференции нужно указать её имя. Протокол точно такой же. 

Проверка на имя может проходить и на клиенте.

После это клиент посылает всем участникам информацию о том, что в конференции есть новый участник. Участник обменивается ключами шифрования с каждым из предыдущих и они начинают обмен потоками.

Подробнее об этом в отдельной сноске.

5.4. Клиент посылает запрос серверу о том, что он хочет отсоединиться от конференции:

Конференция

id конференции

Информация о том, кто отсоединяется.

Если отсоединяется владелец, то конференция завершается. На клиенте должно быть об этом оповещение.




